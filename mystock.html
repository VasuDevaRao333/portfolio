<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Purchase List</title>
    <style>
        /* Your existing styles here */
    </style>
</head>

<body>

    <header>
        <h1>Stock Purchase List</h1>
    </header>

    <div class="container">
        <div class="form-container">
            <input type="text" id="company" placeholder="Company Name">
            <input type="number" id="buyingRate" placeholder="Buying Rate">
            <input type="number" id="quantity" placeholder="Quantity">
            <input type="number" id="amount" placeholder="Amount" disabled>
            <input type="date" id="date">
            <button onclick="addEntry()">Add Entry</button>
        </div>

        <!-- Table to show the stock data -->
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Company</th>
                        <th>Buying Rate</th>
                        <th>Quantity</th>
                        <th class="amount">Amount</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="stockList">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const apiUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQho2ryX_e7TXzpxXkLe14UjbQwd8F_l0-LGRtEDIfK7b3up_sGJvhHgFE1f6W8sUilNg15mX-HhvUl/pubhtml'; // Replace with your Apps Script Web App URL

        // Function to add stock entry
        function addEntry() {
            const company = document.getElementById("company").value;
            const buyingRate = parseFloat(document.getElementById("buyingRate").value);
            const quantity = parseFloat(document.getElementById("quantity").value);
            const date = document.getElementById("date").value;
            const amount = buyingRate * quantity;

            if (company && !isNaN(buyingRate) && !isNaN(quantity) && date) {
                // Send data to Google Sheets via Apps Script (POST request)
                fetch(apiUrl, {
                    method: 'POST',
                    body: JSON.stringify({
                        company: company,
                        buyingRate: buyingRate,
                        quantity: quantity,
                        amount: amount.toFixed(2),
                        date: date
                    }),
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert('Entry added successfully');
                            displayStockData(); // Refresh data after adding
                        } else {
                            alert('Error adding entry');
                        }
                    })
                    .catch(error => {
                        alert('Error adding entry');
                        console.error(error);
                    });

                // Clear form fields
                document.getElementById("company").value = '';
                document.getElementById("buyingRate").value = '';
                document.getElementById("quantity").value = '';
                document.getElementById("amount").value = '';
                document.getElementById("date").value = '';
            } else {
                alert("Please fill out all fields correctly.");
            }
        }

        // Function to display stock data from Google Sheets
        function displayStockData() {
            fetch(apiUrl + '?action=getData')
                .then(response => response.json())
                .then(data => {
                    const stockList = document.getElementById("stockList");
                    stockList.innerHTML = '';

                    data.forEach((entry) => {
                        const newRow = document.createElement("tr");
                        newRow.innerHTML = `
                            <td>${entry[0]}</td>
                            <td>${entry[1]}</td>
                            <td>${entry[2]}</td>
                            <td class="amount">${entry[3]}</td>
                            <td>${entry[4]}</td>
                            <td><button onclick="removeStock(${entry[0]})">Remove</button></td>
                        `;
                        stockList.appendChild(newRow);
                    });
                })
                .catch(error => {
                    console.error('Error loading stock data', error);
                });
        }

        // Call displayStockData when the page loads
        window.onload = displayStockData;
    </script>

</body>

</html>
